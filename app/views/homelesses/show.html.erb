<% content_for :title, "#{@homeless.name} #{@homeless.last_name}" %>

<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.10&appId=138160146783533";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

<div class="container">
  <div class="row">
    <div class="col-sm-4 col-sm-offset-4">
      <div class= "avatar avatar-big">
        <% if @homeless.photos.any? %>
        <%= cl_image_tag @homeless.photos.last.picture, height: 120, width: 120, crop: :fill %>
        <% end %>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-sm-4 col-sm-offset-4">
     <div class="sign-in-text text-center">
       <h5> <%= @homeless.name%> <%= @homeless.last_name %> </h5>
       <div class="fb-share-button fb-button" data-href="<%= homeless_url(@homeless) %>" data-layout="button" data-size="large" data-mobile-iframe="true"><a class="fb-xfbml-parse-ignore " target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=<%= ERB::Util.url_encode homeless_url(@homeless) %>&amp;src=sdkpreparse">Share</a></div>
       </div>
   </div>
 </div>

 <div class="row">
  <div class="col-sm-6">
    <div class= "sign-in-text">
      <% if @homeless.story.present? %>
      <p> <strong> Story </strong> </p>
      <%= @homeless.story %>
      <% else %>
      <%= link_to 'Create Story', edit_homeless_path(@homeless), class: "btn btn-primary" %>
      <% end  %>
    </div>
  </div>

  <div class="col-sm-4 col-sm-offset-2">
    <div class= "sign-in-text">
      <%= simple_form_for [@homeless, @photo] do |f| %>
      <%= f.input :picture, label: 'Add/Upload a Profile picture' %>
      <%= f.input :picture_cache, as: :hidden %>
      <%= f.submit "Update Profile Picture" %>
      <% end %>
    </div>
<%= link_to "Edit #{@homeless.name}", edit_homeless_path(@homeless), class: "btn btn-primary btn-edit" %>

  </div>
</div>
</div>

<div class= "text-center">
  <% if riser_signed_in? %>
    <button id="myBtn" class="btn btn-yours btn-contact" >Get <%=@homeless.name%> Contact </button>
  <%else%>
    <%= link_to "Contact #{@homeless.name}", new_riser_session_path , class: "btn btn-yours btn-contact" %>
    </p>
  <% end %>
<div>

<!-- The Modal -->
<div id="myModal" class="modal" role="dialog">
  <!-- Modal content -->
    <div class="modal-content" id="homeless_modal">
      <%= simple_form_for(@intention, remote: true, url: create_interest_homeless_path(@homeless)) do |f| %>
        <%= f.input :content, label: "Choose your intention", collection: Intention::OPTIONS, input_html: {class:"sign-in-text"}, label_html: {class:"sign-in-text"} %>
        <div id="error-message"> </div>
        <%= f.submit "Get the contact", class:"btn btn-primary" %>
      <% end %>
    </div>
</div>


<div id="map" style="width: 100%; height: 200px;"></div>

<% content_for(:after_js) do %>
  <%= javascript_tag do %>
    $(document).ready(function() {
      var handler = Gmaps.build('Google',
        {markers:
          {clusterer: {
          gridSize: 200,
          maxZoom: 10}}});
          handler.buildMap({internal: { id: 'map' } }, function() {
          markers = handler.addMarkers(<%= raw @hash.to_json %>);
          handler.bounds.extendWith(markers);
          handler.fitMapToBounds();
          if (markers.length == 0) {
            handler.getMap().setZoom(2);
          } else if (markers.length == 1) {
          handler.getMap().setZoom(14);
          }
          handler.removeMarkers(markers);
      });
    });

    // Get the modal
    var modal = document.getElementById('myModal');

    // Get the button that opens the modal
    var btn = document.getElementById("myBtn");

    // When the user clicks on the button, open the modal
    btn.onclick = function() {
        modal.style.display = "block";
    }

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
  <% end %>
<% end %>


<!--  <div class= "text-center">
<p> <%= link_to "Create a review", new_homeless_review_path(@homeless), class: "btn btn-yours btn-show " %> </p>
<div> -->

  <div class="container">
    <div class="row">
      <% @homeless.reviews.last(3).each do |review| %>
      <div class="col-xs-12 col-sm-6 col-md-4">
        <div class="testimonial">
          <div class="pic">
            <%= image_tag review.riser.picture %>
          </div>
          <h3 class="testimonial-title"><%= review.riser.name %></h3>
          <!-- <small class="post"></small> -->
          <p class="description">
            <%= review.content.truncate(100) %>...
          </p>
            <%= image_tag review.picture, class: "img-responsive img-center" %>
        </div>

      </div>
      <% end %>
    </div>
  </div>


